# Vue的Diff算法

### 抽象化解释

VNode和真实的DOM节点一一对应，然后diff的算法是在更新VNode的前提下，寻找最小的代价来进行更新。并且这个更新过程是一个递归过程，即如果存在子节点可以复用的话，那么会深度优先遍历子节点，进行利用存在的结点，从而达到整棵树上的资源复用。

### 整个Diff算法的流程

我们以一个例子来说明一下怎么处理：

```js
// 旧列表
oldCh,oldStart,oldEnd
// 新列表
ch,newStart,oldEnd

A | B | C |
A | E | C | B |
```

diff算法，是一种双指针的算法，从两端向中间遍历。

1. 首先是判断两个首结点或者尾结点是否相同，如果相同，不做任何处理。
2. 其次判断旧的首节点和新的尾结点是否相同，如果相同的话，就要进行元素的迁移，即按照新的结点的位置放好
3. 再者是根据key来建立Map，这样的目的是为了简化后面的寻找时间，如果有Key的话，可以将查询时间看作是1，如果没有map的话，是要在数组里面查找，时间复杂度会是n。
4. 最后如果newCh遍历完了，将old数组其他没有遍历到的元素清除掉
5. 如果oldCh遍历完，将newCh数字其他没有遍历到的元素创建。

在上面过程中，如果在更新的时候，是存在子结点的时候，会进行递归遍历子代的Vnode，然后进行diff算法的更新。这就是整个过程。