##### 1.Redo和Undo功能

首先了解了canvas画布中的undo和redo功能，canvas中有两种方式来进行实现。

- 第一种是每次进行操作的时候，使用canvas的api将画布快照保存起来。然后redo的时候从栈里面拿快照恢复。这样子缺点很明显，消耗大量内存。
- 第二种是每次将用户的动作保存起来，然后有个指针，每次redo或者undo的时候，从0开始画到指针的位置。这样可以避免存储大量的快照，减少内存开销以及加快速度。

不过canvas最后的的动作是将整块画布重绘。但是svg可以部分更新。我的想法是可以借用第二种的思路，将用户的所有的操作进行记录，其实就是记录树状数据的走向，使用链表和一个指针，指针代表版本，链表上面的节点代表用户对整棵树的操作的记录。具体如何实现呢？

- 首先给每个代码块加一个标志，也就是唯一标识，即id，用来区分不同的代码块，这是实现的前提。
- 每次对数据进行操作的时候，比如创建、移动、删除等等，都会在这个链表上增加一个表项，这个对象里面会有几个重要的属性，一个是from属性，一个是to，这两个属性表示前后之间的状态，当然会有指针指向父容器，方便我们进行寻找并且修改数据。
- 每次在进行redo或者undo 的时候，针对于链表上的数据修改这颗树状结构，利用vue的数据响应系统进行更新至页面上。

##### 2.性能提升问题

1. 前端维护svg画布上的代码块使用一个大型的树状结构，当页面上的内容很多。由于这棵树并不是搜索树，所以查询的时间复杂度是n，如果n很大，那么会造成卡顿。

   解决办法：

   树的每个代码块是一个组件，在dom元素上添加某个属性引用到该节点所对应的数据节点，这样能够借助event.target来快速定位到目标数据。并且在子节点中添加一个指向父亲节点的指针。

2. 使用事件委托的方式，将鼠标的事件绑定到svg画布上面去即可，这样可以避免在过多的元素的事件绑定。