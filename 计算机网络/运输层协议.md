# 运输层协议

### 引言

在计算机网络的五层协议中，网络层是主机与主机之间的联系，而运输层是应用程序与应用程序之间的联系的一层。在网络的中心，是由路由器构成的，而路由器是没有进程的，也就是说路由器只有到达网络层这一层，而没有往上的层数。而在网络边缘的主机，是具备完整的五层协议内容。

这里有个问题，运输层和网络层是否可以合并做一层？

答案是可以，但是没必要。原因：

- 在一台主机中，进行网络通信的应用程序不止一个，它们之间通过端口号区分，而在网络层中区分不同主机是通过主机号来区分的。如果两层叠加在一起的话，需要处理的逻辑太复杂
- 不符合**TCP/IP**协议的分层思想。

### 一、UDP报文协议

#### 1.UDP报文特点

- 无连接：进行传输的话，不需要先进行连接，只要有就可以进行传输数据
- 不可靠：不提供可靠的服务。（这里的不可靠服务指的是指不能保证发送的总体数据和就收的总体数据一样，但会保证发送单个报文是无差错的（有差错的报文丢弃））。
- 面向报文：应用程序传下来的数据要先封装成一个报文，在**UDP**协议加个首部再往下层进行处理。
- 提供1对1，多对1,1对多服务
- 没有拥塞控制
- 首部开销小

#### 2.UDP报文头部

- 目标地址
- 源地址（可选）
- 长度
- 检验和

### 二、TCP报文协议

#### 1.TCP报文特点

- 面向连接：需要先经过套接字进行连接才能进行传输数据，传输完数据后要进行释放连接
- 提供可靠传输：保证传输的数据完整地、不出错地传输。
- 面向字节流：应用层下来的数据是字节流，在运输层封装成**TCP**数据报后向下传输。
- 提供逻辑上全双工点对点通信
- 拥塞控制

#### 2.TCP报文头部

TCP报文头部最少是20字节，最大是60字节（有可变长的选项）。

#### 3.TCP可靠传输的工作原理

**TCP**从发送方到接收方发送数据报文的顺序如下：

- 客户端发送数据到服务端，服务端收到数据后会发送确认请求，会有以下的情况
  - 客户端如果长时间没收到确认请求，那么就重发一次数据到服务端（会有次数限制）
  - 客户端如果收到，继续发下一个报文

这样**TCP**协议就保证了每次发送的数据都是成功接收到的，所以**TCP**提供可靠的传输。

#### 4.TCP可靠传输的实现

#### 5.TCP的流量控制

#### 6.TCP的拥塞控制

#### 7.三次握手四次挥手机制