# Vue选项初始化

## 1.computed属性初始化

首先要注意到`computed`的实质就是创建一个数据，并且对这个数据进行某些特定方法的观察（比如以下例子）

```js
data() {
  a: 1
},
computed: {
  b() {
  	return this.a + 1;
	}   
}
```

当`a`变化的时候，`b`就会随着`a`进行变化。

知道了这一点后我们接下来对`computed`选项进行讲解。

### 预处理

- 初始化观察者`computed`观察者列表
- 判断当前的环境，浏览器环境下就进行创建观察者
- 将`computed`的函数作为该属性的`getter`函数

### 创建computed观察者

将`computed`处理完的`getter`作为观察者回调函数进行创建观察者。

### 进行定义computed

进行重新定义该`computed`对象的`getter`方法，并且将`getter`

## 2.props属性初始化

### 关闭观察者处理

由于传进来的属性，如果是一个对象或者数组的话，很大可能在父组件中被深度观察了（初始化`data`选项的时候进行处理），那么在本子组件中是没有必要进行观察的（但是传进来的`props`第一层还是要观察的）。所以调用了全局不允许进行创建观察者的操作。并且等到初始化完毕才开启。

### 校验选项

对于父组件传进来的`props`和本组件自己定义的`props`选项进行校验。

- 先专门针对于`Boolean`类型进行处理，这是为了方便用户直接在木板上定义这样的一个属性：

  ```html
  <child isHide  或者 isHide="isHide"></child>
  <!-- 这样的在组组件中，就为默认设为true -->
  ```

- 针对于没有传进来值，但是使用了`props`选项的`default`的时候，进行获取默认值。

  - 如果存在`default`值的话，判断这个`default`是否是一个对象，如果是的话就报错（因为如果默认值是一个对象的话，一定要是一个类似于`data`选项，是一个工厂函数返回对象）。
  - 不存在`default`时候为`undefined`

- 针对于没有传进来值的情况下，还要对这个值进行创建观察（因为没有其他实例创建观察，此时就可以进行深度观察）。

- 最后才是真正的进行类型检验

### 对实例的_props进行第一层的观察

由于本组件会用到`_props`中出现的数据，那么要进行第一层的观察，以便进行下一步的操作。

## 3.watch选项初始化

## 4.methods选项初始化

对于`methods`选项的初始化是很简单的一件事。即会先进行判断是否在`props`存在、判断是否是函数、判断是否是保留函数。简单一句话：`methods`里面的值一定是不可以在`vm`实例上的第一层冲突的函数。

## 5.Data选项初始化

`Data`选项的初始化，需要进行检验，如下步骤：

- 首先获取`data`，`data`是在选项合并的时候合成的一个函数，现在要执行这个函数来获取数据，但是我们要先对`data`的类型进行检查，因为在进行`data`的初始化之前我们会回调一次`vue`的生命周期，这也是`vue`的生命周期中`beforeCreate`，因为开发者有可能在`beforeCreate`期间对于`$data`进行修改，修改成其他类型。
- 其次我们会`data`执行结果进行类型的检测，如果不是`JSON`格式的话，会进行报错。
- 再者会进行检验`data`、`props`、`methods`的命名是否重复了，如果重复的情况下会进行报错
- 接下来是对非保留属性的`data`属性进行代理，将`_data`里面的属性代理到`vm`中，这样我们可以从`vm`直接访问到`vm._data`里面的属性。保留属性就是以_或者$开头的属性。
- 接下来就是进行观察数据了。

而详细的数据观察的话，可以看一下`Vue`的数据响应系统。

[Vue数据响应系统](./Vue数据响应系统.md)